# X33 Liquid Staking Vault

## Overview

The `X33` contract is a liquid staking and auto-compounding vault for the `xYSK` token.
It allows users to stake their `xYSK` and receive a liquid, yield-bearing token (`X33`) in return.
The contract abstracts away the complexities of voting and reward compounding,
providing a simple way for users to earn yield on their `xYSK`.

## Key Features

- **Liquid Staking:** Wraps `xYSK` into the `X33` token, which is a standard ERC20 token that can be freely traded, transferred, and used in other DeFi protocols.
- **Auto-Compounding:** The contract automatically claims and reinvests rewards, leading to a continuous increase in the value of the `X33` token relative to `xYSK`.
- **Automated Governance:** A designated `operator` (managed by the protocol team) is responsible for voting on behalf of all stakers, maximizing the rewards for the vault.
- **ERC4626 Compliance:** The `X33` contract implements the ERC4626 Tokenized Vault Standard, ensuring interoperability with other protocols that support this standard.

## Core Mechanics

### Deposits and Withdrawals

- **Deposits:** Users can deposit their `xYSK` into the vault by calling the `deposit()` function. They receive a proportional amount of `X33` tokens.
- **Withdrawals:** Users can redeem their `X33` tokens for `xYSK` by calling the `withdraw()` function.
  The amount of `xYSK` they receive is determined by the current `x33:xYSK` ratio.

### Reward Generation

The `X33` vault earns rewards from two primary sources:

1. **Rebase Rewards:** These are the standard staking rewards for holding `xYSK`.
   The `operator` claims these rewards from the `VoteModule` using the `claimRebase()` function.
2. **Voting Incentives (Bribes):** These are rewards paid by third parties to incentivize votes for their liquidity pools.
   These rewards can be in various tokens (e.g., `USDC`, `USDT`).
   The `operator` claims these incentives using the `claimIncentives()` function.

### Reward Conversion and Compounding

This is the core of the auto-compounding mechanism:

1. **Swap Incentives:** The `operator` calls the `swapIncentiveViaAggregator()` function to swap the collected voting incentives (e.g., `USDC`) for the protocol's native `YSK` token.
   This is done through a whitelisted DEX aggregator to ensure the best possible swap rates.
2. **Compound Rewards:** The `operator` then calls the `compound()` function, which does two things:
   - It converts the accumulated `YSK` into `xYSK`.
   - It deposits all the `xYSK` (both the newly converted and the rebase rewards) back into the `VoteModule` to earn more rewards in the future.

### `X33:xYSK` Ratio Increase

The value of the `X33` token is designed to increase over time relative to `xYSK`.
This is achieved by increasing the `ratio()` of `xYSK` held by the vault to the total supply of `X33` tokens.

**`ratio = total xYSK in the vault / total supply of X33`**

When the `compound()` function is executed, the `total xYSK in the vault` increases, while the `total supply of X33` remains the same.
This leads to a direct increase in the `ratio`, meaning that each `X33` token becomes redeemable for a larger amount of `xYSK`.

## Operator Responsibilities

The `operator` of the `X33` contract has the following key responsibilities:

- **Voting:** Submitting votes on behalf of the vault's depositors using the `submitVotes()` function.
- **Claiming Rewards:** Claiming rebase rewards and voting incentives.
- **Swapping and Compounding:** Swapping incentive tokens and compounding the rewards to increase the vault's yield.
- **Unlocking:** Unlocking the vault for deposits and withdrawals using the `unlock()` function.

## Security Considerations

The `X33` contract includes several security measures:

- **Operator and AccessHub Control:** Critical functions are restricted to the `operator` or the `accessHub`, preventing unauthorized access.
- **Reentrancy Guard:** The contract uses OpenZeppelin's `ReentrancyGuard` to prevent reentrancy attacks.
- **Whitelisted Aggregators:** The `swapIncentiveViaAggregator()` function can only be used with whitelisted DEX aggregators, reducing the risk of malicious aggregator contracts.
